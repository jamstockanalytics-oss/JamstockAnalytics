name: ğŸ” Verify EXPO_TOKEN Configuration

on:
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Test mode for verification'
        required: false
        default: 'true'

jobs:
  verify-expo-token:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify EXPO_TOKEN Secret
        run: |
          echo "ğŸ” Checking EXPO_TOKEN configuration..."
          
          if [[ -z "${{ secrets.EXPO_TOKEN }}" ]]; then
            echo "âŒ EXPO_TOKEN is NOT set"
            echo "ğŸ’¡ Please add EXPO_TOKEN to your repository secrets:"
            echo "   1. Go to Settings â†’ Secrets and variables â†’ Actions"
            echo "   2. Click 'New repository secret'"
            echo "   3. Name: EXPO_TOKEN"
            echo "   4. Value: Your Expo token from https://expo.dev/settings/tokens"
            echo ""
            echo "ğŸ”§ Without EXPO_TOKEN:"
            echo "   âœ… Web builds will work"
            echo "   âŒ Android builds will fail"
            echo "   âŒ iOS builds will fail"
            exit 1
          else
            echo "âœ… EXPO_TOKEN is configured!"
            echo "ğŸ”§ Token length: ${#EXPO_TOKEN}"
            echo "ğŸ‰ All builds (Android, iOS, Web) should work!"
          fi
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: Test Expo CLI
        run: |
          echo "ğŸ” Testing Expo CLI availability..."
          if command -v expo &> /dev/null; then
            echo "âœ… Expo CLI is available"
          else
            echo "ğŸ“¦ Installing Expo CLI..."
            npm install -g @expo/cli
            echo "âœ… Expo CLI installed"
          fi
          
          echo "ğŸ” Testing Expo authentication..."
          if expo whoami &> /dev/null; then
            echo "âœ… Expo authentication working"
          else
            echo "âš ï¸  Expo authentication may need setup"
            echo "ğŸ’¡ Run 'expo login' locally to test"
          fi

      - name: Summary
        run: |
          echo ""
          echo "ğŸ¯ EXPO_TOKEN Verification Summary:"
          echo "=================================="
          if [[ -n "${{ secrets.EXPO_TOKEN }}" ]]; then
            echo "âœ… EXPO_TOKEN: Configured"
            echo "âœ… Android Builds: Ready"
            echo "âœ… iOS Builds: Ready" 
            echo "âœ… Web Builds: Ready"
            echo ""
            echo "ğŸš€ All platforms ready for deployment!"
          else
            echo "âŒ EXPO_TOKEN: Missing"
            echo "âš ï¸  Android Builds: Will fail"
            echo "âš ï¸  iOS Builds: Will fail"
            echo "âœ… Web Builds: Will work"
            echo ""
            echo "ğŸ”§ Add EXPO_TOKEN to enable mobile builds"
          fi

